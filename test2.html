<!DOCTYPE html>
<meta charset="utf-8">
<style>

circle {
  fill-opacity: 0.2;
  transition: fill-opacity 250ms linear;
}

circle.active {
  stroke: #f00;
}

.agree-chart {
  position: relative;
  width: 1140px;
}
.agree-chart::after{
  border-style: solid;
  border-width: 3px 12px 3px 0;
  border-color: transparent rgb(200, 200, 200) transparent transparent;
  content: ' ';
  width: 0;
  height: 0;
  position: absolute;
  left: -12px;
  bottom: 4px;
}
.agree-chart::before{
  border-style: solid;
  border-width: 3px 0 3px 12px;
  border-color: transparent transparent transparent rgb(200, 200, 200);
  content: ' ';
  width: 0;
  height: 0;
  position: absolute;
  right: -12px;
  bottom: 4px;
}

.agree-chart svg {
  border-bottom: 6px solid rgb(200, 200, 200);
}

</style>
<div class="agree-chart">
  <svg width="1140" height="300"></svg>
</div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script
src="http://code.jquery.com/jquery-2.2.4.min.js"
integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
crossorigin="anonymous"></script>
<script type="text/javascript" src="faker.js"></script>
<script type="text/javascript" src="index.js"></script>
<script>

/*var data = d3.range(100).map(Math.random);
console.log(data)*/

d3.helper = {};

d3.helper.tooltip = function(){
    var tooltipDiv;
    var bodyNode = d3.select('body').node();

    function tooltip(selection){

        selection.on('mouseover.tooltip', function(pD, pI){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body')
                           .append('div')
                           .attr('class', 'tooltip')
            var absoluteMousePos = d3.mouse(bodyNode);
            console.log(absoluteMousePos)
            tooltipDiv.style('left', absoluteMousePos[0] + 'px')
            tooltipDiv.style('top', absoluteMousePos[1] + 'px')
            tooltipDiv.style('position', 'absolute')
            tooltipDiv.style({
                'left': absoluteMousePos[0] + 10 +'px',
                'top': absoluteMousePos[1] - 40+'px',
                'background-color': '#d8d5e4',
                'width': '65px',
                'height': '30px',
                'padding': '5px',
                'position': 'absolute',
                'z-index': 1001,
                'box-shadow': '0 1px 2px 0 #656565'
            });

            var first_line = '<p>X-Value:</p>'
            var second_line = '<p>Y-Value:</p>'

            tooltipDiv.html(first_line + second_line)
        })
        .on('mousemove.tooltip', function(pD, pI){
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style({
                left: (absoluteMousePos[0] + 10)+'px',
                top: (absoluteMousePos[1] - 40)+'px'
            });
        })
        .on('mouseout.tooltip', function(pD, pI){
            // Remove tooltip
            tooltipDiv.remove();
        });

    }

    tooltip.attr = function(_x){
        if (!arguments.length) return attrs;
        attrs = _x;
        return this;
    };

    tooltip.style = function(_x){
        if (!arguments.length) return styles;
        styles = _x;
        return this;
    };

    return tooltip;
};

var data = []

for(var i = 0; i <= 20; i++) {
  var object = {
    name: faker.name.findName(),
    date: faker.date.future().getTime(),
    sum: Math.floor(Math.random() * (1000 - 1 + 1)) + 1,
    avatar: faker.internet.avatar(),
    id: faker.commerce.product().toLowerCase()
  }
  data.push(object)
}

var svg = d3.select("svg"),
    margin = {top: 194, right: 50, bottom: 214, left: 50},
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    g = svg.append("g")
    .on("mouseover", function(d){
      console.log('lol');
      //gBrush.call(brush.move, [0.3, 0.5].map(x));
    })//.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleLinear().range([0, width]),
    y = d3.randomNormal(height / 2, height / 8);

var brush = d3.brushX()
    .extent([[0, 0], [width, height]])
    .on("start brush end", brushmoved);

g.append("g")
    .attr("transform", "translate(0," + height + ")")

var gBrush = g.append("g")
    .attr("class", "brush")
    .call(brush);

    var circle = g
      .selectAll("circle")
      .data(data)
      .enter().append("circle")
        .attr("transform", function(d) { console.log(+d.sum);return "translate(" + d.sum + "," + y() + ")"; })
        .attr("r", 10)
        .call(d3.helper.tooltip());

/*var handle = gBrush.selectAll(".handle--custom")
  .data([{type: "w"}, {type: "e"}])
  .enter().append("path")
    .attr("class", "handle--custom")
    .attr("fill", "#666")
    .attr("fill-opacity", 0.8)
    .attr("stroke", "#000")
    .attr("stroke-width", 1.5)
    .attr("cursor", "ew-resize")
    .attr("d", d3.arc()
        .innerRadius(0)
        .outerRadius(height / 2)
        .startAngle(0)
        .endAngle(function(d, i) { return i ? Math.PI : -Math.PI; }));*/

//gBrush.call(brush.move, [0.3, 0.5].map(x));

function brushmoved() {
  var s = d3.event.selection;
  if (s == null) {
    //handle.attr("display", "none");
    circle.classed("active", false);
  } else {
    var sx = s.map(x.invert);
    circle.classed("active", function(d) { return sx[0] <= d.sum && d.sum <= sx[1]; });
    //handle.attr("display", null).attr("transform", function(d, i) { return "translate(" + s[i] + "," + height / 2 + ")"; });
  }
}

</script>
